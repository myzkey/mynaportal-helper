# マイナポータル検索メタデータ抽出ツール

## 概要

このツールは、マイナポータルの拡張機能開発を支援する簡易的な補助ツールです。マイナポータルのWebページからテキストを抽出し、OpenAI APIを使用して検索に最適化されたメタデータ（タイトル、説明文、キーワード、カテゴリ）を生成します。これにより、マイナポータル内の各機能やサービスを効率的に検索できるデータを作成できます。

## このツールの位置づけ

- **補助ツール**: 本ツールは開発の効率化のための補助的なスクリプトです
- **一時的な使用**: 検索データの初期生成やアップデート時に使用する一時的なツール
- **完成品ではない**: 必要に応じてカスタマイズして使用することを想定

## 機能

- URLからページのテキストとタイトルを抽出
- OpenAI APIを使用した最適な検索用のメタデータの生成
- 複数URLの一括処理
- 結果をJSON形式で保存

## インストール

```bash
# 依存パッケージのインストール
pnpm install
```

## 使用方法

### 前提条件

- `.env`ファイルをプロジェクトルートに作成し、OpenAI APIキーを設定

```txt
OPENAI_API_KEY=your_api_key_here
```

### 単一URLの処理

```bash
pnpm start https://example.com
```

### 事前定義された全URLの処理

```bash
pnpm start all
```

### 出力ディレクトリのクリア

```bash
pnpm clean
```

## 簡易的な補助機能

### URLリストの管理

`urls.ts`ファイルで処理対象のURLリストを管理できます。以下のように定義します：

```typescript
// src/urls.ts
export const urls = [
  'https://myna.go.jp/page1',
  'https://myna.go.jp/page2',
  // ... 他のURL
];
```

### カスタムカテゴリの設定

OpenAIによるカテゴリ選択の精度を高めるため、`openai.ts`内のカテゴリリストをカスタマイズできます：

```typescript
const categories = [
  '戸籍', '税金', '年金', '保険', '福祉', '子育て', '介護',
  // 必要に応じて変更・追加
];
```

### 手動データ修正

生成されたJSONデータは手動で編集し、必要に応じて修正できます。特に以下の点を確認すると良いでしょう：

- タイトルの正確性
- キーワードの追加や不要なキーワードの削除
- カテゴリの修正

### 実装へのコピペ

生成されたJSONデータは、拡張機能の検索機能実装に直接コピー&ペーストして使用できます。例：

```typescript
// 拡張機能のコードに追加
const searchData = [
  {
    "title": "引越し手続きガイド",
    "description": "マイナンバーカードを使った引越し関連手続きの一括申請",
    "url": "https://example.com",
    "keywords": ["引越し", "住所変更", "転出届"],
    "category": "戸籍"
  },
  // 他のデータ...
];
```

## 認証が必要なページへの対応

認証が必要なページやスクレイピングが難しいURLについては、以下の手順でテキストを直接取得することができます：

### Chromeのコンソールを使用したテキスト抽出

1. 認証が必要なページに正常にログインします
2. F12キーを押すか右クリック→「検証」を選択してデベロッパーツールを開きます
3. 「Console」タブを選択します
4. 以下のコードを貼り付けて実行すると、ページのテキストがクリップボードにコピーされます：

```javascript
// ページ内の<main>タグ内のすべての段落テキストを抽出してコピー
copy(
  [...document.querySelector('main').querySelectorAll('p')]
  .map(el => el.innerText)
  .join(' ')
)

// より広範囲なテキスト抽出（<main>タグ内の多くの要素を対象）
copy(
  [...document.querySelector('main').querySelectorAll('p, h1, h2, h3, h4, h5, h6, li, td, th, span, div')]
    .filter(el => el.innerText.trim().length > 0 && getComputedStyle(el).display !== 'none')
    .map(el => el.innerText.trim())
    .join(' ')
)
```

コピーしたテキストをChatGPTなどのAIツールに貼り付け、キーワードを取得することができます。

## 出力形式

生成されるJSONファイルは以下の形式です：

```json
[
  {
    "title": "引越し手続きガイド",
    "description": "マイナンバーカードを使った引越し関連手続きの一括申請",
    "url": "https://example.com",
    "keywords": [
      "引越し",
      "住所変更",
      "転出届",
      "転入届",
      "マイナンバーカード",
      "住民票",
      "オンライン手続き",
      "ワンストップ",
      "住民登録",
      "転居",
      "住所変更手続き"
    ],
    "category": "戸籍"
  },
]
```

## 注意事項

- 大量のURLを処理する場合はOpenAI APIの利用料金に注意してください
- 抽出失敗したURLは処理をスキップし、最終的なログに表示されます
- このツールは開発補助用であり、エンドユーザー向けの機能ではありません

## ライセンス

MIT
